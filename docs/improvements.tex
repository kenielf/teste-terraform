\documentclass{article}

\usepackage{fancyvrb}
\VerbatimFootnotes
\usepackage{minted}
\usepackage{indentfirst}
\usepackage{hyperref}
\hypersetup{
    colorlinks=true,
    linkcolor=black,
    filecolor=magenta,
    urlcolor=cyan,
    pdftitle={NeoTasker - Documentação},
    pdfpagemode=FullScreen,
}
\urlstyle{same}
\usepackage{titlesec}
\setcounter{secnumdepth}{4} % Use paragraphs as another added depth
\titleformat{\paragraph}
{\normalfont\normalsize\bfseries}{\theparagraph}{1em}{}
\titlespacing*{\paragraph}
{0pt}{3.25ex plus 1ex minus .2ex}{1.5ex plus .2ex}



\begin{document}
\tableofcontents
\pagebreak

\section{Correções}
\subsection{Associação da Tabela de Rotas: Remoção de Tags}
A configuração contém um parâmetro que quando \Verb{terraform apply} é executado resulta em um erro fatal de argumento não suoprtado\footnote{
    Versões: Terraform - v1.9.8, AWS Provider - v5.72.1, TLS Provider v4.0.6
}:

\begin{minted}[autogobble]{text}
    Error: Unsupported argument

      on main.tf line 72, in resource "aws_route_table_association" "main_association":
      72:   tags = {

    An argument named "tags" is not expected here.
\end{minted}

\section{Melhorias}
\subsection{Segurança}
\subsubsection{Aumento de Tamanho de Chave TLS}
A chave TLS tem tamanho de 2048 bits, o que é considerado suficiente em várias plataformas, porém se aceitável o trade-off entre peformance e segurança, aumentar o tamanho de chave para 4096 bits \href{https://security.stackexchange.com/questions/171308/how-to-interpret-this-statement-against-4096-bit-rsa}{resulta em 28 bits de melhora na segurança da chave}.

\subsubsection{Limitação Ingress/Egress}
\begin{minted}[autogobble]{terraform}
    resource "aws_security_group" "main_sg" {
      name        = "${var.projeto}-${var.candidato}-sg"
      description = "Permitir SSH somente de endereços autorizados"
      vpc_id      = aws_vpc.main_vpc.id

      # Regras de entrada
      ingress {
        description      = "Allow SSH from anywhere"
        from_port        = 22
        to_port          = 22
        protocol         = "tcp"
        cidr_blocks      = ["8.8.8.8/32"]  # IP da Google como exemplo somente.
        ipv6_cidr_blocks = []
      }

      ingress {
        description      = "Allow HTTPS traffic"
        from_port        = 443
        to_port          = 443
        protocol         = "tcp"
        cidr_blocks      = ["0.0.0.0/0"]
        ipv6_cidr_blocks = ["::/0"]
      }

      # Regras de saída
      egress {
        description      = "Allow all outbound traffic"
        from_port        = 0
        to_port          = 0
        protocol         = "-1"
        cidr_blocks      = ["0.0.0.0/0"]
        ipv6_cidr_blocks = ["::/0"]
      }

      tags = {
        Name = "${var.projeto}-${var.candidato}-sg"
      }
    }
\end{minted}

As regras de tráfego de entrada e saída foram alteradas para limitar o acesso por SSH para endereços específicos e o tráfego HTTPS somente.

\subsubsection{Princípio do Menor Privilégio}
Uma melhoria proposta, porém não realizada devido a maior complexidade é a implementação do \href{https://www.cloudflare.com/pt-br/learning/access-management/principle-of-least-privilege/}{Princípio do Menor Privilégio}. Que requer alterações de cargos e regras de políticas de IAM, como por exemplo:

\begin{minted}[autogobble]{terraform}
resource "aws_iam_role" "ec2_role" {
  name = "${var.projeto}-${var.candidato}-ec2-role"

  assume_role_policy = jsonencode({
    Version = "2012-10-17"
    Statement = [
      {
        Action    = "sts:AssumeRole"
        Principal = {
          Service = "ec2.amazonaws.com"
        }
        Effect    = "Allow"
        Sid       = ""
      }
    ]
  })
}

resource "aws_iam_policy" "ec2_policy" {
  name        = "${var.projeto}-${var.candidato}-policy"
  description = "Policy for limited access to necessary resources"

  policy = jsonencode({
    Version = "2012-10-17"
    Statement = [
      {
        Effect = "Allow"
        Action = [
          "s3:GetObject",
          "s3:PutObject"
        ]
        Resource = "arn:aws:s3:::EXAMPLE_BUCKET/*"
      },
    ]
  })
}

resource "aws_iam_role_policy_attachment" "attach_policy" {
  role       = aws_iam_role.ec2_role.name
  policy_arn = aws_iam_policy.ec2_policy.arn
}
\end{minted}

\subsubsection{Habilitar Logs da VPC}
É possível armazenar o tráfego da VPC usando um bucket S3, cargo e política IAM, e VPC Flow Log. Essa configuração foi aplicada e se encontra na configuração atual.

\subsection{Nginx}
A instalação do nginx foi feita a partir da abertura das portas HTTP e HTTPS, e da extensão do script de inicialização para instalar pelo apt, configurar e habilitar por default.

\begin{minted}[autogobble]{bash}
    #!/bin/bash
    apt-get update -y
    apt-get upgrade -y
    apt-get install nginx -y
    systemctl enable --now nginx
\end{minted}

\subsubsection{Instalação do Fail2Ban}
Fail2Ban é uma aplicação que regula o acesso, e garante maior segurança em relação ao acesso do EC2 com SSH. Essa configuração foi aplicada e está localizada no script de inicialização do EC2 contido no repositório.

\subsection{Organização}
\subsubsection{Segmentação Da Configuração}
A configuração de toda a infraestrutura foi modularizada para garantir uma melhor manutenção dos diferentes componentes.

\subsubsection{Uso de Comentários}
Foram adicionado comentários em diversas seções da configuração do terraform, para facilitar a organização e a legibilidade da mesma.

\subsubsection{Script de Inicialização Isolado}
O script de inicialização foi movido para seu próprio arquivo, e incluído no repositório.
\section{Resultados Esperados}
Com essas modificações, o resultado esperado é de melhorias de segurança, observabilidade e organização da infraestrutura, por meio dos recursos disponibilizados pela AWS e pelo terraform.

\end{document}
